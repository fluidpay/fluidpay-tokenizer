!function(){"use strict";var t={};({658:function(t,e){var n=this&&this.__awaiter||function(t,e,n,i){return new(n||(n=Promise))((function(a,o){function r(t){try{p(i.next(t))}catch(t){o(t)}}function s(t){try{p(i.throw(t))}catch(t){o(t)}}function p(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(r,s)}p((i=i.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,i,a,o,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(s){return function(p){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,s[0]&&(r=0)),r;)try{if(n=1,i&&(a=2&s[0]?i.return:s[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,s[1])).done)return a;switch(i=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,i=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!((a=(a=r.trys).length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){r.label=s[1];break}if(6===s[0]&&r.label<a[1]){r.label=a[1],a=s;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(s);break}a[2]&&r.ops.pop(),r.trys.pop();continue}s=e.call(t,r)}catch(t){s=[6,t],i=0}finally{n=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,p])}}};Object.defineProperty(e,"__esModule",{value:!0});var a="/api/tokenizer",o=function(){function t(t){var e=this;if(this.container=null,this.settings={id:"",apikey:"",amount:""},this.applePay={btn:null},this.clickApplePay=function(){var t,a;if(ApplePaySession){var o=null===(a=null===(t=e.settings)||void 0===t?void 0:t.payment)||void 0===a?void 0:a.applePay;if(o){var r=new ApplePaySession(o.version||5,{countryCode:o.payment.countryCode,currencyCode:o.payment.currencyCode,total:o.payment.total,merchantCapabilities:o.payment.merchantCapabilities||["supports3DS"],supportedNetworks:o.payment.supportedNetworks||["amex","chinaUnionPay","discover","interac","masterCard","privateLabel","visa","jcb","cartesBancaires","eftpos","electron","elo","maestro","vPay","mada"],supportedCountries:o.payment.supportedCountries,lineItems:o.payment.lineItems,requiredBillingContactFields:o.payment.requiredBillingContactFields,requiredShippingContactFields:o.payment.requiredShippingContactFields});r.onvalidatemerchant=function(t){return n(e,void 0,void 0,(function(){return i(this,(function(e){return fetch("".concat(this.url,"/api/public/applepay/validatemerchant"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({PKeyCompany:o.key,AppleMerchantId:o.appleMerchantID,ValidationUrl:t.validationURL,domainName:o.domainName})}).then((function(t){return t.json()})).then((function(t){return r.completeMerchantValidation(t)})).catch((function(){console.error("merchant validation failed"),r.completeMerchantValidation({error:"merchant validation failed"})})),[2]}))}))},r.onpaymentauthorized=function(t){o.autoPay(t).then((function(t){e.submission({status:t}),"success"===t?r.completePayment(ApplePaySession.STATUS_SUCCESS):r.completePayment(ApplePaySession.STATUS_FAILURE)})).catch((function(){r.completePayment(ApplePaySession.STATUS_FAILURE)}))},r.begin()}else console.error("Apple Pay is missing from configuration")}else console.warn("Apple Pay is not available")},this.onLoad=function(){},this.validCard=function(){},this.achOnChange=function(){},this.magStripeSwipe=function(){},this.onPaymentChange=function(){},this.submission=function(){},this.errorPass=function(){},!t.apikey)throw new Error("apikey must be set!");this.apikey=t.apikey,this.url=t.url&&""!==t.url?t.url:"{{formUrl}}",t.amount&&(this.amount=t.amount),this.id=this.uuid(),"object"==typeof t.settings&&(this.settings=t.settings),t.onLoad&&(this.onLoad=t.onLoad),t.validCard&&(this.validCard=t.validCard),t.achOnChange&&(this.achOnChange=t.achOnChange),t.magStripeSwipe&&(this.magStripeSwipe=t.magStripeSwipe),t.onPaymentChange&&(this.onPaymentChange=t.onPaymentChange),t.submission&&(this.submission=t.submission),window.addEventListener("message",(function(t){e.messageListener(t)})),this.iframe=this.buildIframe(),this.waitForContainer(t.container,(function(t){if(!t)throw new Error("Could not find container");e.iframe.onload=function(){e.settings.id=e.id,e.settings.apikey=e.apikey,e.settings.amount=e.amount,e.setSettings(e.settings),e.onLoad()},e.container=t,e.container.appendChild(e.iframe),e.initApplePay(t)}))}return t.prototype.create=function(){},t.prototype.getApiKeyURL=function(){return this.getTokenizerURL()+"/"+this.apikey},t.prototype.getTokenizerURL=function(){var t=this.url;return!t&&window.location.href.includes("localhost")?"http://localhost:8082".replace(/\/$/,"")+a:t.replace(/\/$/,"")+a},t.prototype.initApplePay=function(t){var e,n,i,a,o;if((null===(i=null===(n=null===(e=this.settings)||void 0===e?void 0:e.payment)||void 0===n?void 0:n.types)||void 0===i?void 0:i.includes("apple_pay"))||(null===(o=null===(a=this.settings)||void 0===a?void 0:a.payment)||void 0===o?void 0:o.applePay)){document.head.insertAdjacentHTML("beforeend","\n    <style>\n      apple-pay-button {\n          --apple-pay-button-width: 100%;\n          --apple-pay-button-height: 20px;\n          border-radius: 4px;\n          border: solid 1px #DCDEE2;\n      }\n    </style>\n    ");var r=document.createElement("script");r.setAttribute("src","https://applepay.cdn-apple.com/jsapi/v1.1.0/apple-pay-sdk.js"),r.setAttribute("async",""),r.setAttribute("crossorigin",""),document.head.appendChild(r),this.populateApplePayBtn(t)}},t.prototype.populateApplePayBtn=function(t){this.applePay.btn=document.createElement("apple-pay-button"),this.applePay.btn.setAttribute("buttonstyle","white"),this.applePay.btn.setAttribute("type","pay"),this.applePay.btn.setAttribute("locale","en-US"),this.applePay.btn.onclick=this.clickApplePay,t.appendChild(this.applePay.btn)},t.prototype.hideAutoPayButtons=function(t){var e,n=this;""!==t&&"apple_pay"!==t?(null===(e=this.applePay.btn)||void 0===e||e.remove(),this.applePay.btn=null):this.waitForContainer(this.container,(function(t){t&&(n.applePay.btn||n.populateApplePayBtn(t))}))},t.prototype.isSurchargeable=function(t,e){return""!==t&&-1===["CO","CT","ME","MA"].indexOf(t.toUpperCase())&&!(!e||!e.card_type||"credit"!==e.card_type.toLowerCase())},t.prototype.submit=function(t){var e=this;this.getGuardianData().then((function(t){var n;(null===(n=t.events)||void 0===n?void 0:n.length)&&e.postMessage({event:"setGuardian",data:t})})).then((function(){e.postMessage({event:"submit",data:{amount:t}})})).catch((function(){e.postMessage({event:"submit",data:{amount:t}})}))},t.prototype.setExpDate=function(t){this.postMessage({event:"setExpDate",data:{value:t}})},t.prototype.setError=function(t){this.postMessage({event:"setError",data:{input:t}})},t.prototype.postMessage=function(t){var e=this.iframe.contentWindow;if(null!==e){var n=JSON.stringify(t);e.postMessage(n,"*")}},t.prototype.uuid=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t.prototype.waitForContainer=function(t,e){if(t){var n=Date.now();!function i(){"string"!=typeof t||null===document.querySelector(t)?"string"!=typeof t&&t?e(t):setTimeout((function(){Date.now()-n>1e4?e(null):i()}),1e3):e(document.querySelector(t))}()}else e(null)},t.prototype.buildIframe=function(){var t=document.createElement("iframe");return t.src=this.getApiKeyURL(),t.setAttribute("allow","payment"),t.style.display="block",t.style.border="none",t.style.margin="0px",t.style.padding="0px",t.style.width="1px",t.style.minWidth="100%",t.style.height="30px",t.style.overflow="hidden",t.style.backgroundColor="transparent",t.style.transition="all .3s ease-out",t.frameBorder="0",t},t.prototype.setSettings=function(t){this.postMessage({event:"setSettings",data:t})},t.prototype.updateHeight=function(t){t&&(this.iframe.style.height=t+"px")},t.prototype.getGuardianData=function(){var t=window.Guardian;return t&&t.getData&&"function"==typeof t.getData?t.getData():Promise.reject()},t.prototype.messageListener=function(t){try{var e=JSON.parse(t.data),n=e.id;if(this.id!==n)return;var i=e.event,a=e.data;if(!i)return;switch(i){case"submission":this.submission(a);break;case"validCard":this.validCard(a);break;case"achOnChange":this.achOnChange(a);break;case"magStripeSwipe":this.magStripeSwipe(a);break;case"onPaymentChange":this.onPaymentChange(a.type),this.hideAutoPayButtons(a.type);break;case"setHeight":this.updateHeight(a.height)}}catch(t){}},t}();e.default=o}})[658](0,t),module.exports.Tokenizer=t.default}();