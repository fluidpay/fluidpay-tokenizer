"use strict";(self["webpackChunkfluidpay_tokenizer"]=self["webpackChunkfluidpay_tokenizer"]||[]).push([[313],{507:function(e,t,a){a.d(t,{K:function(){return n}});const n="pub_0wUsHIlrkK1I6ADno5MfT10UjhR"},430:function(e,t,a){function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e,t){if("object"!==n(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var i=a.call(e,t||"default");if("object"!==n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function s(e){var t=i(e,"string");return"symbol"===n(t)?t:String(t)}function o(e,t,a){return t=s(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}a.d(t,{Z:function(){return u}});const r="{{formUrl}}",p="http://localhost:8082",l="/api/tokenizer";class u{constructor(e){if(o(this,"id",void 0),o(this,"apikey",void 0),o(this,"url",void 0),o(this,"amount",void 0),o(this,"iframe",void 0),o(this,"container",null),o(this,"settings",{id:"",apikey:"",amount:""}),o(this,"applePay",{btn:null}),o(this,"clickApplePay",(()=>{if(!ApplePaySession)return void console.warn("Apple Pay is not available");const e=this.settings?.payment?.applePay;if(!e)return void console.error("Apple Pay is missing from configuration");const t=["amex","chinaUnionPay","discover","interac","masterCard","privateLabel","visa","jcb","cartesBancaires","eftpos","electron","elo","maestro","vPay","mada"],a=new ApplePaySession(e.version||5,{countryCode:e.payment.countryCode,currencyCode:e.payment.currencyCode,total:e.payment.total,merchantCapabilities:e.payment.merchantCapabilities||["supports3DS"],supportedNetworks:e.payment.supportedNetworks||t,supportedCountries:e.payment.supportedCountries,lineItems:e.payment.lineItems,requiredBillingContactFields:e.payment.requiredBillingContactFields,requiredShippingContactFields:e.payment.requiredShippingContactFields});a.onvalidatemerchant=async t=>{fetch(`${this.url}/api/public/applepay/validatemerchant`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({PKeyCompany:e.key,AppleMerchantId:e.appleMerchantID,ValidationUrl:t.validationURL,domainName:e.domainName})}).then((e=>e.json())).then((e=>a.completeMerchantValidation(e))).catch((()=>{console.error("merchant validation failed"),a.completeMerchantValidation({error:"merchant validation failed"})}))},a.onpaymentauthorized=t=>{e.autoPay(t).then((e=>{this.submission({status:e}),"success"===e?a.completePayment(ApplePaySession.STATUS_SUCCESS):a.completePayment(ApplePaySession.STATUS_FAILURE)})).catch((()=>{a.completePayment(ApplePaySession.STATUS_FAILURE)}))};try{a.begin()}catch(n){console.error(n)}})),o(this,"onLoad",(()=>{})),o(this,"validCard",(()=>{})),o(this,"achOnChange",(()=>{})),o(this,"magStripeSwipe",(()=>{})),o(this,"onPaymentChange",(()=>{})),o(this,"submission",(()=>{})),o(this,"errorPass",(()=>{})),!e.apikey)throw new Error("apikey must be set!");this.apikey=e.apikey,this.url=e.url&&""!==e.url?e.url:r,e.amount&&(this.amount=e.amount),this.id=this.uuid(),"object"===typeof e.settings&&(this.settings=e.settings),e.onLoad&&(this.onLoad=e.onLoad),e.validCard&&(this.validCard=e.validCard),e.achOnChange&&(this.achOnChange=e.achOnChange),e.magStripeSwipe&&(this.magStripeSwipe=e.magStripeSwipe),e.onPaymentChange&&(this.onPaymentChange=e.onPaymentChange),e.submission&&(this.submission=e.submission),window.addEventListener("message",(e=>{this.messageListener(e)})),this.iframe=this.buildIframe(),this.waitForContainer(e.container,(e=>{if(!e)throw new Error("Could not find container");this.iframe.onload=()=>{this.settings.id=this.id,this.settings.apikey=this.apikey,this.settings.amount=this.amount,this.setSettings(this.settings),this.onLoad()},this.container=e,this.container.appendChild(this.iframe),this.initApplePay(e)}))}create(){}getApiKeyURL(){return this.getTokenizerURL()+"/"+this.apikey}getTokenizerURL(){const e=this.url;return window.location.href.includes("localhost")?p.replace(/\/$/,"")+l:e.replace(/\/$/,"")+l}initApplePay(e){if(!this.settings?.payment?.types?.includes("apple_pay")&&!this.settings?.payment?.applePay)return;document.head.insertAdjacentHTML("beforeend","\n    <style>\n      apple-pay-button {\n          --apple-pay-button-width: 100%;\n          --apple-pay-button-height: 20px;\n          border-radius: 4px;\n          border: solid 1px #DCDEE2;\n      }\n    </style>\n    ");const t=document.createElement("script"),a="https://applepay.cdn-apple.com/jsapi/v1.1.0/apple-pay-sdk.js";t.setAttribute("src",a),t.setAttribute("async",""),t.setAttribute("crossorigin",""),document.head.appendChild(t),this.populateApplePayBtn(e)}populateApplePayBtn(e){this.applePay.btn=document.createElement("apple-pay-button"),this.applePay.btn.setAttribute("buttonstyle","white"),this.applePay.btn.setAttribute("type","pay"),this.applePay.btn.setAttribute("locale","en-US"),this.applePay.btn.onclick=this.clickApplePay,e.appendChild(this.applePay.btn)}hideAutoPayButtons(e){""!==e&&"apple_pay"!==e?(this.applePay.btn?.remove(),this.applePay.btn=null):this.waitForContainer(this.container,(e=>{e&&(this.applePay.btn||this.populateApplePayBtn(e))}))}isSurchargeable(e,t){const a=["CO","CT","ME","MA"];return""!==e&&(-1===a.indexOf(e.toUpperCase())&&!(!t||!t.card_type||"credit"!==t.card_type.toLowerCase()))}submit(e){this.getGuardianData().then((e=>{e.events?.length&&this.postMessage({event:"setGuardian",data:e})})).then((()=>{this.postMessage({event:"submit",data:{amount:e}})})).catch((()=>{this.postMessage({event:"submit",data:{amount:e}})}))}setExpDate(e){this.postMessage({event:"setExpDate",data:{value:e}})}setError(e){this.postMessage({event:"setError",data:{input:e}})}postMessage(e){const t=this.iframe.contentWindow;if(null!==t){const a=JSON.stringify(e);t.postMessage(a,"*")}}uuid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}waitForContainer(e,t){if(!e)return void t(null);const a=Date.now(),n=1e3,i=1e4;(function s(){"string"!==typeof e||null===document.querySelector(e)?"string"!==typeof e&&e?t(e):setTimeout((()=>{i&&Date.now()-a>i?t(null):s()}),n):t(document.querySelector(e))})()}buildIframe(){const e=document.createElement("iframe");return e.src=this.getApiKeyURL(),e.setAttribute("allow","payment"),e.style.display="block",e.style.border="none",e.style.margin="0px",e.style.padding="0px",e.style.width="1px",e.style.minWidth="100%",e.style.height="30px",e.style.overflow="hidden",e.style.backgroundColor="transparent",e.style.transition="all .3s ease-out",e.frameBorder="0",e}setSettings(e){this.postMessage({event:"setSettings",data:e})}updateHeight(e){e&&(this.iframe.style.height=e+"px")}getGuardianData(){const e=window.Guardian;return e&&e.getData&&"function"===typeof e.getData?e.getData():Promise.reject()}messageListener(e){try{const t=JSON.parse(e.data),a=t.id;if(this.id!==a)return;const n=t.event,i=t.data;if(!n)return;switch(n){case"submission":this.submission(i);break;case"validCard":this.validCard(i);break;case"achOnChange":this.achOnChange(i);break;case"magStripeSwipe":this.magStripeSwipe(i);break;case"onPaymentChange":this.onPaymentChange(i.type),this.hideAutoPayButtons(i.type);break;case"setHeight":this.updateHeight(i.height);break}}catch(e){}}}},313:function(e,t,a){a.r(t),a.d(t,{default:function(){return U}});var n=a(252),i=a(577),s=a(963);const o={class:"main home"},r={class:"language-javascript"},p={class:"section"},l={class:"fieldset"},u=(0,n._)("label",null,"Apple Pay Result:",-1),c=(0,n._)("option",{value:"success"}," Success ",-1),d=(0,n._)("option",{value:"fail"}," Fail ",-1),h=[c,d],y={class:"section apple-pay-example"},m={ref:"example"},g={key:0,class:"example"},b=(0,n._)("label",{class:"title"},"Submit Result",-1),f={key:1,class:"example"},P=(0,n._)("label",{class:"title"},"AutoPay event value",-1);function v(e,t,a,c,d,v){return(0,n.wg)(),(0,n.iD)("div",o,[(0,n._)("pre",null,[(0,n.Uk)("      "),(0,n._)("code",r,"\n        // Example Code\n        var example = new Tokenizer({\n          apikey: 'key here',\n          container: document.querySelector('#div container'),\n          submission: (resp) => {\n            console.log(resp)\n          },\n          settings: {\n            processorId: '', // optional\n            payment: {\n              types: ['apple_pay'],\n              applePay: {\n                // required\n                key: '',\n                // required\n                autoPay: async (data: ApplePayAutoPayEvent): Promise<AutoPayResult> => {\n                  // sending the data to your api and processing it\n                  return '"+(0,i.zw)(e.applePayOpts.autoPayResult)+"'\n                },\n                // optional\n                appleMerchantID: '',\n                // optional\n                domainName: '',\n                // optional, default 5\n                version: 5,\n                // required\n                payment: {\n                  // required\n                  countryCode: 'US',\n                  // required\n                  currencyCode: 'USD',\n                  // required\n                  total: {\n                    label: 'Total',\n                    amount: '10.00',\n                  },\n                  // optional, default 'supports3DS'\n                  merchantCapabilities: ['supports3DS'],\n                  // optional, default ['amex', 'chinaUnionPay', 'discover', 'interac', 'masterCard', 'privateLabel', 'visa', 'jcb', 'cartesBancaires', 'eftpos', 'electron', 'elo', 'maestro', 'vPay', 'mada']\n                  supportedNetworks: ['visa', 'mastercard', 'amex'],\n                  // optional\n                  requiredBillingContactFields: ['email', 'name', 'phone', 'postalAddress'],\n                  // optional\n                  requiredShippingContactFields: ['email', 'name', 'phone', 'postalAddress'],\n                  // optional\n                  supportedCountries: ['US'],\n                  // optional\n                  lineItems: [\n                    {\n                      label: 'Tax',\n                      amount: '1.00',\n                    },\n                    {\n                      label: 'Product 1',\n                      amount: '2.00',\n                    }\n                  ]\n                }\n              }\n            }\n          }\n        })\n      ",1),(0,n.Uk)("\n    ")]),(0,n._)("div",p,[(0,n._)("div",l,[u,(0,n.wy)((0,n._)("select",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.applePayOpts.autoPayResult=t)},h,512),[[s.bM,e.applePayOpts.autoPayResult]])])]),(0,n._)("div",y,[(0,n._)("div",m,null,512),e.submitResponse?((0,n.wg)(),(0,n.iD)("div",g,[b,(0,n._)("pre",null,(0,i.zw)(e.submitResponse),1)])):(0,n.kq)("",!0),e.autoPayResponse?((0,n.wg)(),(0,n.iD)("div",f,[P,(0,n._)("pre",null,(0,i.zw)(e.autoPayResponse),1)])):(0,n.kq)("",!0)])])}var C=a(430),S=a(507),w=(0,n.aZ)({name:"ApplePay",data(){return{example:null,autoPayResponse:"",submitResponse:"",applePayOpts:{autoPayResult:"success"}}},mounted(){this.example=new C.Z({apikey:S.K,url:"",container:this.$refs.example,submission:e=>{this.submitResponse=e},settings:{payment:{showTitle:!0,types:["apple_pay"],applePay:{key:"cppdkrpuevgm8uqsmjng",autoPay:async e=>(this.autoPayResponse=JSON.stringify(e.payment,null,2),this.applePayOpts.autoPayResult||"success"),payment:{countryCode:"US",currencyCode:"USD",total:{label:"Total",amount:"10.00"},requiredBillingContactFields:["email","name","phone","postalAddress"],requiredShippingContactFields:["email","name","phone","postalAddress"],lineItems:[{label:"Tax",amount:"1.00"},{label:"Product 1",amount:"2.00"}]}}}}})}}),k=a(744);const A=(0,k.Z)(w,[["render",v]]);var U=A}}]);
//# sourceMappingURL=313.a71272b9.js.map